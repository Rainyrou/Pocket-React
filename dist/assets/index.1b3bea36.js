import{_ as F,a as x,b as z,f as E,c as w,r as h,R as s,d as C,e as B,u as S,l as k}from"./index.643a4602.js";import"./index.a6c30508.js";import{B as N}from"./index.d7aa8145.js";import{I as R}from"./index.f209f82c.js";import{a as I,s as T,T as U,x as D,y as P,z as L}from"./index.a7e9ada9.js";import{N as A}from"./index.4cf952b0.js";import"./ConfigReceiver.47be707e.js";function q(t){var i=/image.*/;return!!t.match(i)}function O(t){var i=t.size,n=t.name,e=t.type||n.substr(n.lastIndexOf(".")+1),a=q(e);return{fileName:n,fileSize:i,fileType:e,isPic:a}}function $(t,i,n){var e=document.createElement("canvas"),a=e.getContext("2d");if(!a)return console.error("\u8BF7\u4F7F\u7528\u9AD8\u7248\u672C\u6D4F\u89C8\u5668\uFF0C\u8BE5\u7248\u672C\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u751F\u6210\u7F29\u7565\u56FE"),"";var r=t.width,l=t.height;return e.width=r,e.height=l,a.fillStyle="#fff",a.fillRect(0,0,e.width,e.height),a.drawImage(t,0,0,r,l),i&&!(i>0&&i<=1)&&console.error("\u8BF7\u8F93\u5165\u6709\u6548\u7684\u538B\u7F29\u6BD4\u4F8B, \u6CA1\u6709\u5C06\u9ED8\u8BA4\u4F7F\u7528 0.92"),e.toDataURL(n,i)}function j(t){var i=t.file,n=t.quality,e=t.fileType,a=t.maxWidth,r=t.maxHeight;return new Promise(function(l){var u=document.createElement("img");window.URL=window.URL||window.webkitURL,u.onload=function(){var o;n||a||r?o=$(u,n,e):o=u.src,l(o||"")},u.src=window.URL.createObjectURL(i)})}function G(t,i){var n=t.file,e=t.quality,a=O(n),r=a.fileSize,l=a.fileType,u=a.isPic,o=a.fileName,f={file:n,fileType:l,fileSize:r,fileName:o,thumbnail:""},g=function(p){f.thumbnail=p,i(f)};u?j({file:n,quality:e,fileType:l}).then(function(c){return g(c)}).catch(function(c){return console.error(c)}):i(f)}function H(t){var i=W();return function(){var e=C(t),a;if(i){var r=C(this).constructor;a=Reflect.construct(e,arguments,r)}else a=e.apply(this,arguments);return B(this,a)}}function W(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var b=function(t){F(n,t);var i=H(n);function n(){var e;x(this,n);for(var a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];return e=i.call.apply(i,[this].concat(r)),e.file=null,e.handleDefaultInput=function(u){u.currentTarget.value="";var o=e.props,f=o.onBeforeSelect,g=o.disabled;typeof f=="function"&&(f()===!1||g)&&u.preventDefault()},e.handleClick=function(){e.file.click()},e.handleChange=function(u){var o=e.props,f=o.onChange,g=o.quality,c=o.multiple,p=[].slice.call(u.target.files),d=[],_=function(v){c?(d.push(v),p.length===d.length&&typeof f=="function"&&f(d)):typeof f=="function"&&f(v)};p&&p.map(function(y){return G({file:y,quality:g},_)})},e}return z(n,[{key:"render",value:function(){var a=this,r=this.props,l=r.prefixCls,u=r.className,o=r.multiple,f=r.accept,g=r.capture,c=r.disabled,p=r.children,d=E(l,u,w({},"".concat(l,"--disabled"),c)),_=h.exports.cloneElement(p,{onClick:this.handleClick,className:E(p.props.className,"needsclick")});return s.createElement("div",{className:d},s.createElement("input",{className:"".concat(l,"__input"),type:"file",ref:function(v){a.file=v},accept:f,multiple:o,capture:g,onClick:this.handleDefaultInput,onChange:this.handleChange}),_)}}]),n}(h.exports.PureComponent);b.defaultProps={prefixCls:"za-file-picker",disabled:!1,multiple:!1,onBeforeSelect:function(){return!0}};const K="_userinfo_g2zg7_1",J="_gradientBG_g2zg7_1",M="_navbar_g2zg7_7",Q="_item_g2zg7_11",V="_title_g2zg7_15",X="_avatar_g2zg7_19",Y="_avatar-url_g2zg7_23",Z="_desc_g2zg7_29",ee="_upload_g2zg7_35",te="_signature_g2zg7_41",ae="_btn_g2zg7_44";var m={userinfo:K,gradientBG:J,navbar:M,item:Q,title:V,avatar:X,avatarUrl:Y,desc:Z,upload:ee,signature:te,btn:ae};const ue=()=>{const t=S(),[i,n]=h.exports.useState({}),[e,a]=h.exports.useState(""),[r,l]=h.exports.useState(""),u=localStorage.getItem("token"),o=async()=>{const{data:c}=await I("/api/user/get_userinfo");n(c),console.log(c),a(c.avatar),l(c.signature)};h.exports.useEffect(()=>{o()},[]);const f=async()=>{await T("/api/user/edit_userinfo",{signature:r,avatar:e}),U.show("\u4FEE\u6539\u6210\u529F"),t.goBack()},g=c=>{let p=new FormData;p.append("file",c.file),D({method:"post",url:`${P}/upload`,data:p,headers:{"Content-Type":"multipart/form-data",Authorization:u}}).then(d=>{console.log(d),a(L("/api"+d.data))})};return s.createElement("div",{className:m.userinfo},s.createElement(A,{className:m.navbar,left:s.createElement(k.ArrowLeft,{theme:"primary",onClick:()=>t.push("/")}),title:"\u7528\u6237\u4FE1\u606F"}),s.createElement("div",{className:m.item},s.createElement("div",{className:m.title},"\u5934\u50CF"),s.createElement("div",{className:m.avatar},s.createElement("img",{className:m.avatarUrl,src:e,alt:""}),s.createElement("div",{className:m.desc},s.createElement("span",null,"\u652F\u6301 jpg\u3001png\u3001jpeg \u683C\u5F0F\u5927\u5C0F 200KB \u4EE5\u5185\u7684\u56FE\u7247"),s.createElement(b,{className:m.filePicker,onChange:g,accept:"image/*"},s.createElement(N,{className:m.upload,theme:"primary",size:"xs"},"\u70B9\u51FB\u4E0A\u4F20"))))),s.createElement("div",{className:m.item},s.createElement("div",{className:m.title},"\u4E2A\u6027\u7B7E\u540D"),s.createElement("div",{className:m.signature},s.createElement(R,{clearable:!0,type:"text",value:r,placeholder:"\u8BF7\u8F93\u5165\u4E2A\u6027\u7B7E\u540D",onChange:c=>l(c)}))),s.createElement(N,{className:m.btn,onClick:f,block:!0,theme:"primary"},"\u4FDD\u5B58"))};export{ue as default};
