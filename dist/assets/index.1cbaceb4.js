import{r as a,R as t,I as v,C as L}from"./index.643a4602.js";import{P as j,t as H,T as h,s as b}from"./index.a7e9ada9.js";import{I as $,K as q}from"./index.f209f82c.js";import{c as p}from"./index.b4ed5761.js";import{d as k,P as z}from"./index.6a8f6d46.js";const G="_add-wrap_11omu_1",J="_header_11omu_7",O="_close_11omu_10",Q="_filter_11omu_15",U="_type_11omu_21",V="_expense_11omu_30",X="_active_11omu_33",Y="_income_11omu_38",Z="_time_11omu_43",ee="_arrow_11omu_52",te="_money_11omu_56",se="_sufix_11omu_61",ae="_amount_11omu_66",ne="_type-warp_11omu_70",oe="_type-body_11omu_79",re="_type-item_11omu_83",ue="_iconfont-wrap_11omu_90",ce="_iconfont_11omu_90",me="_remark_11omu_116";var s={addWrap:G,header:J,close:O,filter:Q,type:U,expense:V,active:X,income:Y,time:Z,arrow:ee,money:te,sufix:se,amount:ae,typeWarp:ne,typeBody:oe,typeItem:re,iconfontWrap:ue,iconfont:ce,remark:me};const ie=a.exports.forwardRef(({detail:n={},onReload:D},N)=>{ie.displayName="PopupAddBill";const d=n&&n.id,[A,u]=a.exports.useState(!1),[r,l]=a.exports.useState("expense"),[C,_]=a.exports.useState(new Date),[y,f]=a.exports.useState(""),[g,F]=a.exports.useState(!1),E=a.exports.useRef(),[o,c]=a.exports.useState(""),[x,m]=a.exports.useState({}),[B,I]=a.exports.useState([]),[W,P]=a.exports.useState([]),S=e=>{l(e)},R=e=>{_(e)};a.exports.useEffect(()=>{n.id&&(l(n.pay_type==1?"expense":"income"),m({id:n.type_id,name:n.type_name}),f(n.remark),c(n.amount),_(k(Number(n.date)).$d))},[n]),a.exports.useEffect(async()=>{const e=[{id:1,name:"\u9910\u996E",type:"1",user_id:0},{id:2,name:"\u670D\u9970",type:"1",user_id:0},{id:3,name:"\u4EA4\u901A",type:"1",user_id:0},{id:4,name:"\u65E5\u7528",type:"1",user_id:0},{id:5,name:"\u8D2D\u7269",type:"1",user_id:0},{id:6,name:"\u5B66\u4E60",type:"1",user_id:0},{id:7,name:"\u533B\u7597",type:"1",user_id:0},{id:8,name:"\u65C5\u884C",type:"1",user_id:0},{id:9,name:"\u4EBA\u60C5",type:"1",user_id:0},{id:10,name:"\u5176\u4ED6",type:"1",user_id:0},{id:11,name:"\u5DE5\u8D44",type:"2",user_id:0},{id:12,name:"\u5956\u91D1",type:"2",user_id:0},{id:13,name:"\u8F6C\u8D26",type:"2",user_id:0},{id:14,name:"\u7406\u8D22",type:"2",user_id:0},{id:15,name:"\u9000\u6B3E",type:"2",user_id:0},{id:16,name:"\u5176\u4ED6",type:"2",user_id:0}],i=e.filter(w=>w.type==1),K=e.filter(w=>w.type==2);I(i),P(K),d||m(i[0])},[]);const T=e=>{if(e=String(e),e=="delete"){let i=o.slice(0,o.length-1);c(i);return}if(e=="ok"){M();return}e=="."&&o.includes(".")||e!="."&&o.includes(".")&&o&&o.split(".")[1].length>=2||c(o+e)},M=async()=>{if(!o){h.show("\u8BF7\u8F93\u5165\u5177\u4F53\u91D1\u989D");return}const e={amount:Number(o).toFixed(2),type_id:x.id,type_name:x.name,date:k(C).unix()*1e3,pay_type:r=="expense"?1:2,remark:y||""};d?(e.id=d,await b("/api/bill/update",e),h.show("\u4FEE\u6539\u6210\u529F")):(await b("/api/bill/add",e),c(""),l("expense"),m(B[0]),_(new Date),f(""),h.show("\u6DFB\u52A0\u6210\u529F")),u(!1),D&&D()};return N&&(N.current={show:()=>{u(!0)},close:()=>{u(!1)}}),t.createElement(j,{visible:A,direction:"bottom",onMaskClick:()=>u(!1),destroy:!1,mountContainer:()=>document.body},t.createElement("div",{className:s.addWrap},t.createElement("header",{className:s.header},t.createElement("span",{className:s.close,onClick:()=>u(!1)},t.createElement(v,{type:"wrong"}))),t.createElement("div",{className:s.filter},t.createElement("div",{className:s.type},t.createElement("span",{onClick:()=>S("expense"),className:p({[s.expense]:!0,[s.active]:r==="expense"})},"\u652F\u51FA"),t.createElement("span",{onClick:()=>S("income"),className:p({[s.income]:!0,[s.active]:r==="income"})},"\u6536\u5165")),t.createElement("div",{className:s.time,onClick:()=>E.current&&E.current.show()},k(C).format("MM-DD")," ",t.createElement(v,{className:s.arrow,type:"arrow-bottom"}))),t.createElement("div",{className:s.typeWarp},t.createElement("div",{className:s.typeBody},(r=="expense"?B:W).map(e=>t.createElement("div",{onClick:()=>m(e),key:e.id,className:s.typeItem},t.createElement("span",{className:p({[s.iconfontWrap]:!0,[s.expense]:r=="expense",[s.income]:r=="income",[s.active]:x.id==e.id})},t.createElement(L,{className:s.iconfont,type:H[e.id].icon})),t.createElement("span",null,e.name))))),t.createElement("div",{className:s.remark},g?t.createElement($,{autoHeight:!0,showLength:!0,maxLength:50,type:"text",rows:3,value:y,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u4FE1\u606F",onChange:e=>f(e),onBlur:()=>F(!1)}):t.createElement("span",{onClick:()=>F(!0)},y||"\u6DFB\u52A0\u5907\u6CE8")),t.createElement("div",{className:s.money},t.createElement("span",{className:s.sufix},"\xA5"),t.createElement("span",{className:p(s.amount,s.animation)},o)),t.createElement(q,{type:"price",onKeyClick:e=>T(e)}),t.createElement(z,{ref:E,onSelect:R})))});export{ie as P};
